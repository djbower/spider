--------------------------
GENERAL INSTALLATION NOTES
--------------------------

----------------
DOUBLE PRECISION
----------------

To install with double precision.  This reproduces the behaviour of the
python prototype code.  In this case you must use Patrick's hacked version of
PETSc because this version uses the dense direct solver that is required. But
you can allow PETSc to automatically download and install SUNDIALS
(with double support) so there is no need to install SUNDIALS separately.

0.1 [Optional] Install gcc compilers to the default location from:
       http://hpc.sourceforge.net

   This will install everything into /usr/local

   This step is optional because I think the default CC compiler that
   comes with Mac is OK also.  You only need a C compiler.

0.2 comment out any existing references to PETSC_DIR and PETSC_ARCH in your
profile or bash_profile and resource (clear these variables)

1. get the hacked version of PETSc (Patrick must give you read access to his
bitbucket):

git clone
https://bitbucket.org/psanan/petscfork/branch/psanan/ts-sundials-quad-hack petsc-double-direct

2. change directories and switch to the hacked branch:
cd petsc-double-direct/
git checkout psanan/ts-sundials-quad-hack

PS: is it necessary to download mpich?
3a. configure PETSc using the following command:
./configure --with-debugging=0 --with-fc=0 --download-sundials --download-mpich --with-cc=gcc --with-cxx=g++ --download-mpich --COPTFLAGS="-g -O3" --CXXOPTFLAGS="-g -O3"

3b.  [Aside] For a debug build, amend command above to use --with-debugging=1
and remove optimisation flags

4. make (the following all assume an optimised build, i.e, 3a above):
make PETSC_DIR=/Users/dan/Programs/petsc/petsc-double-direct PETSC_ARCH=arch-darwin-c-opt all

5. run tests:
make PETSC_DIR=/Users/dan/Programs/petsc/petsc-double-direct PETSC_ARCH=arch-darwin-c-opt test

6. test streams:
make PETSC_DIR=/Users/dan/Programs/petsc/petsc-double-direct
PETSC_ARCH=arch-darwin-c-opt streams


-------------------
QUADRUPLE PRECISION
-------------------

0.1 [Optional] Install gcc compilers to the default location from:
       http://hpc.sourceforge.net

   This will install everything into /usr/local

   This step is optional because I think the default CC compiler that
   comes with Mac is OK also.  You only need a C compiler.

0.2 comment out any existing references to PETSC_DIR and PETSC_ARCH in your
profile or bash_profile and resource (clear these variables)

---- A. Install SUNDIALS with quadruple precision ----

1. Patrick needs to give you read access to his bitbucket to obtain
   the quad-supported version of SUNDIALS

2. My clone command is:
   git clone https://djbower@bitbucket.org/psanan/sundials-quad.git sundials-quad
 
3. Install Sundials:
   Notes:
       a. see installation instructions in Sundials manual
       b. use srcdir, builddir, and instdir to create a local build
       c. easiest to use ccmake
          Something like:
              /opt/local/bin/ccmake ../srcdir
       d. can change compilers if desired, e.g., change c compiler to
              /usr/local/bin/gcc
       e. my commands look something like the following, here, the 
          source code is in srcdir, the build is occuring in builddir,
          and the library is installed into instdir.
              ccmake ../srcdir
              BUILD_SHARED_LIBS: ON
              BUILD_STATIC_LIBS: ON
              CMAKE_C_COMPILER: /usr/local/bin/gcc
              CMAKE_AR (‘toggle to advanced mode’):
                  /usr/local/bin/gcc-ar
              ??? CMAKE_C_FLAGS: -g -O2 -fPIC
              probably best to use same as PETSc below
              CMAKE_C_FLAGS: -g -O3
              CMAKE_INSTALL_PREFIX: ../instdir
              EXAMPLES_INSTALL_PATH: ../instdir/examples
              SUNDIALS_PRECISION: quadruple
       f. make
       g. make install


---- B: Install PETSc with quadruple precision ----

0. comment out any existing references to PETSC_DIR and PETSC_ARCH in your
profile or bash_profile and resource (clear these variables)

1. get the hacked version of PETSc (Patrick must give you read access to his
bitbucket):

git clone
https://bitbucket.org/psanan/petscfork/branch/psanan/ts-sundials-quad-hack
petsc-quad-direct

2. change directories and switch to the hacked branch (otherwise you'll get an error about sundials not supporting __float128).

cd petsc-quad-direct/
git checkout psanan/ts-sundials-quad-hack

PS: is it necessary to download mpich / f2cblaslapack?
3a. configure PETSc using the following command.  Crucially, in the next step we point PETSc to the quadruple precision installation of SUNDIALS that we just created:

./configure --with-debugging=0 --with-fc=0 --with-precision=__float128 --with-sundials=1 --with-sundials-dir=/Users/dan/Programs/sundials-quad/instdir --download-mpich --download-f2cblaslapack --with-cc=gcc --with-cxx=g++ --COPTFLAGS="-g -O3" --CXXOPTFLAGS="-g -O3"

3b.  [Aside] For a debug build, amend command above to use --with-debugging=1
and remove optimisation flags

4. make (the following all assume an optimised build, i.e, 3a above):
make PETSC_DIR=/Users/dan/Programs/petsc/petsc-double-direct PETSC_ARCH=arch-darwin-c-opt all

5. run tests:
make PETSC_DIR=/Users/dan/Programs/petsc/petsc-double-direct PETSC_ARCH=arch-darwin-c-opt test

6. test streams:
make PETSC_DIR=/Users/dan/Programs/petsc/petsc-double-direct
PETSC_ARCH=arch-darwin-c-opt streams

------
C CODE
------

1. set PETSC_DIR and PETSC_ARCH to the PETSc installation that you wish to use (either the quad or double precision, as above)
2. make


------------------------------------------------
OLD INSTRUCTIONS.  KEPT FOR REFERENCE BUT IGNORE
------------------------------------------------

The following should work to clone the maint branch and build. You
should change the C/C++/Fortran compilers to whatever works on your
system:

cd /somewhere/to/install
git clone https://bitbucket.org/petsc/petsc -b maint petsc-maint
cd petsc-maint
[See below for Petsc configure for double or quad precision]

Then follow the instructions to build and test a debug build. It will
produce a directory called arch-some-stuff which will be your
PETSC_ARCH, and PETSC_DIR is the directory named "petsc-maint" above.
If you set those, you should be able to build and play with the tests,
for example

    cd $PETSC_DIR/src/ts/examples/tutorials
    make ex1
    ./ex1 -ts_monitor -ts_view -ts_type sundials

The connection here is glacial so I haven't directly tested the above
- apologies in advance when it fails but give it a shot!

If you want master, repeat the above but without the "-b maint" in the
"git clone" command, and with petsc-master as the directory name. You
can then have parallel builds of the two versions of the library.
Better to use maint until we need something specific from master 

for configuring petsc with double precision:

./configure PETSC_ARCH=arch-darwin-c --download-mpich --download-sundials --with-cc=gcc --with-cxx=g++ --with-fc=gfortran --with-debugging=0 --FOPTFLAGS='-g -O3' --COPTFLAGS='-g -O3' --CXXOPTFLAGS='-g -O3'
make PETSC_ARCH=arch-darwin-c

for configuring petsc with quad precision:

./configure PETSC_ARCH=arch-darwin-c-quad --with-precision=__float128 --download-f2cblaslapack --download-mpich --with-cc=gcc --with-cxx=g++ --with-fc=gfortran --with-debugging=0 --FOPTFLAGS='-g -O3' --COPTFLAGS='-g -O3' --CXXOPTFLAGS='-g -O3'
make PETSC_ARCH=arch-darwin-c-quad
