\fbox{\parbox{\textwidth}{Notes that are specific to the derivations in \cite{ABE93}}}

\subsection{Phase Separation}
Under the assumption of no melting/solidification, melt-solid separation is treated merely as a mass-transfer process in a two-phase mixture.  Average density of mixture given by:
\begin{equation}
\frac{1}{\rho} = \frac{1}{\rho_s}(1-\phi)+\frac{1}{\rho_m}\phi
\label{eq:abe1993_rho}
\end{equation}
where $\phi$ is mass fraction of melt.
The masses of solid and melt phases per unit volume of mixture (or spatial density of solid and melt phase) are:
\begin{equation}
\rho_s^\ast \equiv (1-\phi) \rho = \frac{\rho_s \rho_m (1-\phi)}{\rho_s \phi + \rho_m(1-\phi)}
\label{eq:abe1993_rhos}
\end{equation}
\begin{equation}
\rho_m^\ast \equiv \phi \rho = \frac{\rho_s \rho_m \phi}{\rho_s \phi + \rho_m(1-\phi)}
\label{eq:abe1993_rhom}
\end{equation}
Mass conservation of each phase in a 1-D system (no melting/solidification):
\begin{equation}
\frac{\partial \rho_m^\ast}{\partial t} + v_m \frac{\partial \rho_m^\ast}{\partial z} = -\rho_m^\ast \frac{\partial v_m}{\partial z}
\end{equation}
\begin{equation}
\frac{\partial \rho_s^\ast}{\partial t} + v_s \frac{\partial \rho_s^\ast}{\partial z} = -\rho_s^\ast \frac{\partial v_s}{\partial z}
\end{equation}
$v_m$ and $v_s$ are velocities averaged over a small domain in the mixture.  $z$ increases upwards.
Define the velocity of the local barycenter of the mixture, $v$, 
\begin{equation}
v \equiv \frac{\rho_m^\ast}{\rho_m^\ast + \rho_s^\ast} v_m + \frac{\rho_s^\ast}{\rho_m^\ast + \rho_s^\ast} v_s = \phi v_m + (1-\phi) v_s
\end{equation}
enabling us to write the mass conservation equation for the system as a whole:
\begin{equation}
\frac{\partial \rho}{\partial t} + v \frac{\partial \rho}{\partial z} = -\rho \frac{\partial v}{\partial z}
\end{equation}
We also define the vertical mass flux of melt, $J_m$, relative to the local barycenter (characterizes the melt-solid separation processes):
\begin{equation}
J_m \equiv \rho_m^\ast (v_m-v) = \rho \phi (1-\phi)(v_m-v_s)
\end{equation}
Using $v$ and $J_m$:
\begin{equation}
v_m = v + \frac{J_m}{\rho \phi}
\end{equation}
\begin{equation}
v_s = v - \frac{J_m}{\rho (1-\phi)}
\end{equation}
Substituting above 2 equations into mass conservation equations (product and chain rule differentiation, then cancel terms):
\begin{equation}
\frac{\partial \rho_m^\ast}{\partial t} + v \frac{\partial \rho_m^\ast}{\partial z} = -\rho_m^\ast \frac{\partial v}{\partial z} - \frac{\partial J_m}{\partial z}
\label{eq:abe1993_rhom_star}
\end{equation}
\begin{equation}
\frac{\partial \rho_s^\ast}{\partial t} + v \frac{\partial \rho_s^\ast}{\partial z} = -\rho_s^\ast \frac{\partial v}{\partial z} + \frac{\partial J_m}{\partial z}
\label{eq:abe1993_rhos_star}
\end{equation}
We can expand the LHS of equation \ref{eq:abe1993_rhom_star} (using substitution for $\rho_m^\ast=\phi\rho$, the product rule, and the application of mass conservation for the total mixture):
\begin{equation}
  \rho(\frac{\partial \phi}{\partial t} + v \frac{\partial \phi}{\partial z}) + \phi(\frac{\partial \rho}{\partial t} + v \frac{\partial \rho}{\partial z})= \rho(\frac{\partial \phi}{\partial t} + v \frac{\partial \phi}{\partial z})  - \phi\rho \frac{\partial v}{\partial z}
\end{equation}
Canceling the repeated term from the RHS and dividing by $\rho$, we get:
\begin{equation}
\frac{\partial \phi}{\partial t} + v \frac{\partial \phi}{\partial z} = - \frac{1}{\rho} \frac{\partial J_m}{\partial z}
\label{eq:abe1993_phaseSepPart1}
\end{equation}
From Equation \ref{eq:abe1993_rho}, we can rewrite $\phi$ in terms of $\rho$ and material constants:
\begin{equation}
\phi = \frac{\rho_m ( \rho_s - \rho)}{\rho ( \rho_s-\rho_m)}
\end{equation}
We can then simplify the L.H.S. of Equation \ref{eq:abe1993_phaseSepPart1} using the chain rule:
\begin{equation}
  \frac{\partial \phi}{\partial t} + v \frac{\partial \phi}{\partial z} = 
  \frac{\partial \phi}{\partial \rho} ( \frac{\partial \phi}{\partial t} + v \frac{\partial \rho}{\partial z}) = 
  -\rho \frac{\partial \phi}{\partial \rho}\frac{\partial v}{\partial z}
\label{eq:abe1993_phaseSepPart2}
\end{equation}
Assuming that $\rho_m$ and $\rho_s$ are constant and are not functions of depth $z$ (or~$\rho$),
\begin{equation}
\frac{\partial \phi}{\partial \rho} = \frac{\rho_m \rho_s}{\rho^2 (\rho_m-\rho_s)}
\label{eq:abe1993_dphidrho}
\end{equation}
which can be substituted into Equation \ref{eq:abe1993_phaseSepPart2} and combined with Equation \ref{eq:abe1993_phaseSepPart1} to obtain a final expression governing phase separation:
\begin{equation}
\frac{\partial \phi}{\partial t} + v \frac{\partial \phi}{\partial z} = \frac{\rho_m \rho_s}{\rho (\rho_s-\rho_m)} \frac{\partial v}{\partial z}
= - \frac{1}{\rho} \frac{\partial J_m}{\partial z}
\label{eq:abe1993_phaseSep}
\end{equation}

%Working:
%\begin{equation}
%\label{rho}
%\rho = \rho_m^\ast + \rho_s^\ast 
%\end{equation}
%\begin{equation}
%\rho_s^\ast =  \rho-\rho_m^\ast
%\end{equation}
%\begin{equation}
%\rho_m^\ast = \rho \phi
%\end{equation}
%To derive the `main' equation in Abe 1993 you use eqn~\ref{rhosstar} and eqn~\ref{rhomstar}.  To get the expression involving $\partial J_m/\partial z$ (in the main equation) you have to eliminate $\partial v/\partial z$ from equations \ref{rhomstar} and \ref{rhosstar} by combining them.  To do this, you subtract (eqn~\ref{rhosstar} $\times \rho_m^\ast$) from (eqn~\ref{rhomstar} $\times \rho_s^\ast$) and use above substitutions to eliminate $\rho_s^\ast$.  Use product rule to differentiate $(\rho \phi)$ and cancel terms.  Rearrange to give:
%\begin{equation}
%\frac{\partial \phi}{\partial t} + v \frac{\partial \phi}{\partial z} = - \frac{1}{\rho} \frac{\partial J_m}{\partial z}
%\end{equation}
%%%%%
%Now, to get the expression involving $\partial v/\partial z$ in the main equation, you have to combine equations \ref{rhomstar} and \ref{rhosstar} in such a way as to eliminate $\partial J_m/\partial z$.  This is easily done by adding eqn.~\ref{rhomstar} and eqn.~\ref{rhosstar} together.  Then, use eqn~\ref{rho} to combine terms and substitute in eqn~\ref{dphidrho} after applying the chain rule (as follows):
%\begin{equation}
%\frac{\partial \phi}{\partial t} + v \frac{\partial \phi}{\partial z} = - \rho \frac{\partial \phi}{\partial \rho}\frac{\partial v}{\partial z} = \frac{\rho_m \rho_s}{\rho (\rho_s-\rho_m)} \frac{\partial v}{\partial z}
%\label{eq:abe1993_phaseSep}
%\end{equation}
%For a while I went around in circles trying to directly relate $\partial J_m/\partial z$ to $\partial v/\partial z$ and in the end I gave up in favour of simply eliminating the terms using simple addition and subtraction of the equations as outlined above.  This obviously works, which must mean that I was violating some assumptions about mass conversation, or not applying the product or chain rule correctly when trying to get directly from $\partial J_m/\partial z$ to $\partial v/\partial z$.  I never did reach a satisfactory explanation of why I couldn't do it (but interesting to see you ran into the same problem).

\subsection{Time Scale}
Characteristic time scale $\tau$ of melt-solid separation.  Shorter one of the e-folding time of melt fraction or solid fraction change in the lower half of the layer.  Partially molten layer of thickness $L$ with uniform initial melt fraction $\phi_0$.

To separate melt and solid in this half layer, assuming a (representative) mass flux of $J_m$, and a mass fraction of either $\phi$ (melt) or $1-\phi$) (solid):
\begin{equation}
\tau = \frac{\rho L}{2 J_m} \min (\phi_0, 1-\phi_0 )
\end{equation}
Presumably this is referred to as an e-folding time due to the form of the PDE and/or assumed form of the solution (expected exponential decay).  But the timescale is simply a separation time over half the layer thickness.

\subsection{Impact Stirring}

Earth accreted through a series of planetesimal impacts, which had an important effect on magma ocean mixing since each impact stirred the mantle below the impact site.
To gain a first order handle on impact stirring, a simple model is developed assuming a roughly linear accretion rate:
\begin{equation}
\frac{dm}{dt} \sim \frac{M_E}{\tau_{acc}}
\label{eq:abe1993_accrate}
\end{equation}
where $M_E$ is the Earth's mass and $\tau_{acc} \approx 10$~Myr is the assumed total accretion timescale.

Planetesimal impact stirring depends strongly on impactor size, with more massive impactors stirring a mantle region to both a greater depth and over a larger footprint.
To model the impactor masses, we assume a power-law distribution:
\begin{equation}
  \frac{dN}{dm} = {K_{max}\left(\frac{m}{M_{max}}\right)^{-q}}
\end{equation}
where $q=1.5$ describes the relative proportion of large vs small planetesimals, and $M_{max}=0.1 M_E$.
This characteristic mass distribution (with $q<2$), implies that the majority of the Earth was built from large rather than small impactors.
To obtain the value for the constant $K_{max}$, we simply integrate the mass distribution, requiring that the accreted impactors sum to the Earth's total mass, ${M_E = \int_0^{M_{max}} m \frac{dN}{dm}dm}$, yielding:
\begin{equation}
  K_{max} = \frac{2-q}{M_{max}}\left(\frac{M_E}{M_{max}}\right)
\end{equation}
This impactor mass distribution can now be used to determine the effectiveness of impact stirring.

Each impactor is able to stir a region of the Earth's mantle below the impact site, which depends on impact size and velocity.
We consider two overlapping stirred regions: the deep narrow region corresponding to the initial penetration of the impactor itself and the shallow broad region reflecting the resulting impact crater.
By assuming a (simplified) constant accretion rate (Equation \ref{eq:abe1993_accrate}), we can evaluate the depth-dependent impact stirring timescale as a fraction of the total accretion timescale:
\begin{equation}
  \tau_{s}(d) = \frac{\tau_{acc}}{N_{s}(d)}
  \label{eq:abe1993_taustir}
\end{equation}
where $d$ is the depth and $N_{s}$ is the effective number of complete stirring events occurring over the entire accretion period at depth $d$.
The number of stirring events can be approximated as:
\begin{equation}
  N_{s}(d) = \frac{S_s(d)}{4\pi(R_E - d)^2}
\end{equation}
representing simply the ratio of the total stirred area (throughout accretion), $S_s(d)$, to the total planetary area at depth $d$.
This neglects the fact that the Earth grows as it accretes, and thus early impacts collide with a smaller planet, effectively stirring to greater depths.
This expression thus produces only a rough stirring timescale that is actually an upper-bound, when combined with Equation \ref{eq:abe1993_taustir}.
The two stirred regions can be evaluated from impact physics. 

Direct impactor penetration stirring produces disrupts a deep narrow region of the mantle, defined by the impactor size and penetration depth:
\begin{eqnarray}
  s_p =& \pi r_i^2 \\
  d_p =& 2 r_i v_i/v_s
\end{eqnarray}
where the stirred penetration area of a single impact, $s_p$, is simply the cross sectional area of the impactor with radius $r_i$, and the penetration depth $d_p$, depends on the impactor velocity $v_i$ and the shock wave speed $v_s$.


Impact crater formation, on the other hand, disrupts a shallow broad region of the mantle:
\begin{eqnarray}
  s_{crat} =& \pi r_{crat}^2 \\
  d_{crat} =& f_{crat} r_{crat}
\end{eqnarray}
where $r_{crat}$ is the crater radius and $f_{crat}=0.4$ is a typical crater depth to radius ratio.
To determine the crater radius, we rely on crater scaling laws from the literature, like those reported in Davies(1985), rewritten in the form of \cite{ABE93} as:
\begin{equation}
  V_{crat} = \pi f_{crat} r_{crat}^3 = B m_i^{1-\beta/3} (v_i^2/g)^{+ \beta}
\end{equation}
which approximates the crater volume as a cylinder and depends on the impactor mass $m_i$, the impactor velocity $v_i$, and gravity $g$.
The scaling parameters $B$ and $\beta$ characterize the physical scaling between these quantities, where this form is appropriate for large gravity-dominated collisions where target strength is unimportant.

The total stirred area is calculated as an integral over the impactor mass distribution:
\begin{equation}
  S_s(d)= \int_0^{M_{max}} s(m)\Theta(m > m_c(d))  \frac{dN}{dm} dm
\end{equation}
where $m_c(d)$ is the critical mass below which craters are unable to stir to beyond depth $d$, and $\Theta()$ is a step function ensuring that only sufficiently large impactors able to stir to great enough depth contribute to the total stirred area.
When evaluating the total stirred area, Abe (1993) calculated separately for crater and penetration stirring, and used only the shortest timescale.
In reality, we should use the large crater footprint for the shallow regime and the narrow penetration footprint for the deep regime, which is accomplished by splitting this into two separate integrals.

Examination of impact stirring timescales is that they all exceed the timescale for gravitational separation for melt fractions above $\sim$13\%.
Thus, if the melt fraction remains above 0.2 due to suppression from vigorous convective mixing, then impacts play a negligible role.

%K_{max} = \frac{(2-q)M_E}{M_{max}^2}

\subsection{Thermal Evolution of a Magma Ocean}
Begin with the energy (enthalpy) balance equation for a spherically symmetric planet in local thermodynamic equilibrium: 
\begin{equation}
  \frac{\partial H}{\partial t} = - \frac{1}{\rho}\nabla \cdot \vec{J_{tot}} + \Delta V_m|g|\vec{J_m} \cdot \hat{r} + q_{heat}
\end{equation}
where this accounts for the imbalance of energy flows into/out-of a spherical shell at constant pressure, combined with the change in potential energy due to melting density differences, and internal heating (units are energy per unit mass per unit time).
Here  $J_{tot}$ is the total heat flux, $J_m$ is the total mass flux of melt, and $q_{heat}$ is the total heat generated at this depth.  $\hat{r}$ is the radial unit vector.
Note that this total heat generation represents a sum over all sources including radioactive and tidal heating.
Similarly, the total melt mass flux results from both gravitational separation and convective mixing, ${J_m = J_{gm} + J_{cm}}$.

We can expand the divergence in spherical coordinates, dropping non-symmetric terms, and converting from radius to depth: 
\begin{equation}
  \frac{\partial H}{\partial t} = - \frac{1}{4\pi r^2 \rho} \frac{\partial L_{tot}}{\partial r} + \Delta V_m|g|J_{m\hat{r}} + q_{heat}
\end{equation}
where $L_{tot} = 4 \pi r^2 J_{tot}$ is the total luminosity (energy transported upwards per unit time) carried upward past the current depth. 

The total heat flux is a combination of the sensible and latent heat components:
\begin{equation}
  J_{tot} = J_q + T\Delta S_m J_m
\end{equation}
Here $\Delta S_m$ and $\Delta V_m$ are the entropy and volumes of melting (fusion) and $J_q$ is the direct convective heat flux.
The enthalpy and volumes of melting ${\Delta H_m = T(P, [\phi])\Delta S_m(P)}$ and ${\Delta V_m = \Delta V_m(P)}$ are both pressure-dependent quantities (although the entropy change on melting $\Delta S_m$ is often reasonably approximated as constant).

The enthalpy conservation equation implicitly depends on the melt fraction $\phi$ in many places: the convective heat flux $J_q$ depends strongly on the melt-fraction dependent viscosity $\eta(\phi)$, both convective mixing and gravitational separation ${J_m = J_{gm}(\phi) + J_{cm}(\phi)}$, and total density $\rho(\phi)$.
Also, if tidal heating is being considered, tidal dissipation depends very strongly on viscosity, and is thus $\phi$ dependent.
Also note that the melt flux $J_m$ is formerly equal to zero if $\phi=1$ or $\phi=0$.

The form of the energy balance equation used by Abe1993 was in terms of temperature instead of enthalpy (though I think this is less useful, since it makes evolution of a single component system needlessly difficult).
\begin{equation}
  [C_p  + \Delta h (\frac{\partial \phi}{\partial T})_P] \frac{\partial T}{\partial t}= - 4\pi \frac{\partial}{\partial m} r^2[J_q + \Delta h J_m] + \frac{1}{\rho}(\Delta \rho/\rho)|g|J_m + q_{heat}
\end{equation}

We can employ a good approximate expression for the melt fraction:
\begin{equation}
  \phi(H) = \frac{H - H_{sol}}{T\Delta S_m(P)} 
\end{equation}
for $H_{sol} < H < H_{liq}$ and otherwise $\phi = 1$ above the liquidus (or 0 below the solidus).
This expression is exact for single component systems and reasonably accurate for multi-component systems to the extent that the entropy change on melting $\Delta S_m$ has similar values for all solid phases.
This expression replaces the less accurate version in terms of temperature used by Abe 1993 (that further requires equal heat capacities for all solid phases), which is not useful for single component systems where partial melt is pinned to the melting curve.

\begin{itemize}
  \item Use a single component melting curve roughly corresponding to the 50\% solidus line for a realistic mantle chemistry. 
  \item Entropy of melting can be adjusted to ensure solidus and liquidus enthalpy bounds that match the true mantle system. 
  \item Use realistic heat capacity and density values (EOSs) for both solid and liquid phases. 
  \item This relies on 2 approximations: 
    \begin{enumerate}
      \item Chemical differentiation is negligible (second order effect, at least energetically)
      \item The thermal range of the partially molten region ($\sim$200~K) is small compared to the temperature difference across the mantle ($\sim$2500~K). Values from Stixrude(2009).
    \end{enumerate}
  \item Allows us to focus on the role of tidal dissipation at depth for keeping a magma ocean near the critical melt fraction (somewhere between 40\% and 60\%), for extremely long times without having to worry about chemical evolution. 
  \item Later work can more carefully examine multi-component evolution using equations of Abe 1995.
\end{itemize}
%}

The melting curve used by Abe 1993 is from Ohtani (1983).
Ohtani appears to assume a constant entropy change on melting (fairly reasonable assumption) of 8.03 cal/mol/K for MgSiO3 melt.
The enthalpy change in Abe 1993 is likely calculated from this value, $\Delta h = T \Delta S$.
Also, the heat capacity and thermal expansion of the melt are assumed constant (probably less accurate)

\subsection{Gravitational potential energy}
The gravitational potential energy per unit mass is:
\begin{equation}
E_{\rm grav} = \frac{\partial U_{\rm grav}}{\partial m} = - \frac{G M(r)}{r} = - |g(r)|r
\end{equation}
where $U_{\mathrm{grav}}$ is gravitational energy, $m$ mass, $G$ gravitational constant, $r$ radius from centre of mass, $M(r)$ integrated mass from centre of mass to $r$, and $g(r)$ acceleration due to gravity as a function of $r$.
Thus, melting influences gravitational potential energy through its affect on $g(r)$, and because $g(r)$ is an integrated quantity it is not sensitive to small changes to the density distribution.  We therefore neglect changes in $E_{\mathrm{grav}}$ for silicate melting in a magma ocean.  However, this term should be included to model mantle-core differentiation because in this case the density contrast between solid and melt components is large.